<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathCore - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        /* Ø§Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ù€ CSS Ø§Ù„Ù…Ø­Ø³Ù† Ù‡Ù†Ø§ */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f0f2f5;
        }
        #header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #chat-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        #input-section {
            width: 35%;
            padding: 15px;
            background: #fff;
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 4px rgba(0,0,0,0.05);
        }
        #domain-selector {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #4CAF50;
            font-size: 14px;
            background: white;
            cursor: pointer;
            font-weight: bold;
        }
        #question {
            flex: 1;
            resize: none;
            font-size: 16px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        #keyboard-toggle {
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid #888;
            border-radius: 5px;
            background-color: #e0e0e0;
            text-align: center;
            transition: all 0.3s;
        }
        #keyboard-toggle:hover {
            background-color: #d0d0d0;
        }
        #math-keyboard {
            display: none;
            flex-wrap: wrap;
            background: #f9f9f9;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .keyboard-row {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        .keyboard-row button {
            flex: 1 0 auto;
            min-width: 40px;
            margin: 2px;
            padding: 8px 12px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid #888;
            background-color: #e0e0e0;
            transition: all 0.2s;
        }
        .keyboard-row button:hover {
            background-color: #4CAF50;
            color: white;
            transform: scale(1.05);
        }
        #solve-btn {
            padding: 12px;
            font-size: 18px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        #solve-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        #answer-section {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #eef2f5;
        }
        .domain-badge {
            padding: 10px 15px;
            border-radius: 25px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .domain-badge.mathematics { background: #2196F3; color: white; }
        .domain-badge.physics { background: #FF9800; color: white; }
        .domain-badge.mechanical { background: #795548; color: white; }
        .domain-badge.electrical { background: #F44336; color: white; }
        .domain-badge.electronics { background: #9C27B0; color: white; }
        .domain-badge.motors { background: #009688; color: white; }
        .domain-badge.plc { background: #607D8B; color: white; }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            border: 1px solid #ddd;
            border-bottom: none;
        }
        #confidence-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .solution-content, .ai-content {
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #chat-messages {
            margin-top: 20px;
        }
        .message {
            margin-bottom: 10px;
            padding: 12px 15px;
            border-radius: 10px;
            max-width: 90%;
            word-wrap: break-word;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .user-message {
            background: linear-gradient(135deg, #cce5ff, #b8daff);
            align-self: flex-end;
            margin-left: auto;
        }
        .bot-message {
            background: white;
            align-self: flex-start;
        }
        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 16px;
        }
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div id="header">ğŸš€ MathCore - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ø°ÙƒÙŠ</div>
    
    <div id="chat-container">
        <div id="input-section">
            <select id="domain-selector">
                <option value="mathematics">ğŸ“ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                <option value="physics">âš¡ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
                <option value="mechanical">ğŸ”§ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</option>
                <option value="electrical">ğŸ’¡ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                <option value="electronics">ğŸ“Ÿ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                <option value="motors">ğŸ”„ Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                <option value="plc">ğŸ¤– PLC ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¢Ù„ÙŠ</option>
            </select>
            
            <textarea id="question" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."></textarea>
            
            <div id="keyboard-toggle" onclick="toggleKeyboard()">
                âŒ¨ï¸ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ù…ÙˆØ²
            </div>
            
            <div id="math-keyboard">
                <div class="keyboard-row" style="font-weight: bold; color: #4CAF50;">
                    â— Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                </div>
                <div class="keyboard-row">
                    <button onclick="insertSymbol('+')">+</button>
                    <button onclick="insertSymbol('-')">-</button>
                    <button onclick="insertSymbol('*')">Ã—</button>
                    <button onclick="insertSymbol('/')">Ã·</button>
                    <button onclick="insertSymbol('=')">=</button>
                    <button onclick="insertSymbol('^')">^</button>
                    <button onclick="insertSymbol('âˆš')">âˆš</button>
                </div>
                
                <div class="keyboard-row" style="font-weight: bold; color: #2196F3;">
                    ğŸ“ Ø±Ù…ÙˆØ² Ø±ÙŠØ§Ø¶ÙŠØ©
                </div>
                <div class="keyboard-row">
                    <button onclick="insertSymbol('Ï€')">Ï€</button>
                    <button onclick="insertSymbol('âˆ')">âˆ</button>
                    <button onclick="insertSymbol('Î£')">Î£</button>
                    <button onclick="insertSymbol('âˆ«')">âˆ«</button>
                    <button onclick="insertSymbol('âˆ‚')">âˆ‚</button>
                    <button onclick="insertSymbol('âˆ‡')">âˆ‡</button>
                </div>
                
                <div class="keyboard-row" style="font-weight: bold; color: #FF9800;">
                    âš¡ Ø±Ù…ÙˆØ² ÙÙŠØ²ÙŠØ§Ø¡ ÙˆÙƒÙ‡Ø±Ø¨Ø§Ø¡
                </div>
                <div class="keyboard-row">
                    <button onclick="insertSymbol('Î©')">Î©</button>
                    <button onclick="insertSymbol('Âµ')">Âµ</button>
                    <button onclick="insertSymbol('âˆ ')">âˆ </button>
                    <button onclick="insertSymbol('Â°')">Â°</button>
                    <button onclick="insertSymbol('Î±')">Î±</button>
                    <button onclick="insertSymbol('Î²')">Î²</button>
                    <button onclick="insertSymbol('Î³')">Î³</button>
                    <button onclick="insertSymbol('Î¸')">Î¸</button>
                    <button onclick="insertSymbol('Î»')">Î»</button>
                    <button onclick="insertSymbol('Ï‰')">Ï‰</button>
                </div>
                
                <div class="keyboard-row" style="font-weight: bold; color: #795548;">
                    ğŸ”§ Ø±Ù…ÙˆØ² Ù…ÙŠÙƒØ§Ù†ÙŠÙƒ
                </div>
                <div class="keyboard-row">
                    <button onclick="insertSymbol('Ïƒ')">Ïƒ</button>
                    <button onclick="insertSymbol('Ï„')">Ï„</button>
                    <button onclick="insertSymbol('Îµ')">Îµ</button>
                    <button onclick="insertSymbol('Ï')">Ï</button>
                    <button onclick="insertSymbol('Î½')">Î½</button>
                    <button onclick="insertSymbol('âˆ‘')">âˆ‘</button>
                    <button onclick="insertSymbol('âˆ')">âˆ</button>
                </div>
                
                <div class="keyboard-row">
                    <button onclick="insertSymbol('(')">(</button>
                    <button onclick="insertSymbol(')')">)</button>
                    <button onclick="insertSymbol('â‰¤')">â‰¤</button>
                    <button onclick="insertSymbol('â‰¥')">â‰¥</button>
                    <button onclick="insertSymbol('â‰ ')">â‰ </button>
                    <button onclick="insertSymbol('âˆ¥')">âˆ¥</button>
                    <button onclick="insertSymbol('âŠ¥')">âŠ¥</button>
                </div>
            </div>
            
            <button id="solve-btn" onclick="sendQuestion()">
                ğŸ” Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©
            </button>
        </div>
        
        <div id="answer-section">
            <div id="solution-container">
                <div class="section-header">
                    <span>ğŸ“Š Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„</span>
                    <span id="confidence-badge">99% Ø¯Ù‚Ø©</span>
                </div>
                <div id="solution-steps" class="solution-content">
                    Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ ÙˆØ³Ø£Ù‚ÙˆÙ… Ø¨Ø­Ù„Ù‡ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©
                </div>
            </div>
            
            <div id="ai-container">
                <div class="section-header">
                    <span>ğŸ¤– Ø´Ø±Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
                </div>
                <div id="ai-explanation" class="ai-content">
                    Ù‡Ù†Ø§ Ø³ÙŠØ¸Ù‡Ø± Ø´Ø±Ø­ Ù…ÙØµÙ„ Ù„Ù„Ù…Ø³Ø£Ù„Ø©
                </div>
            </div>
            
            <div id="chat-messages"></div>
        </div>
    </div>

    <script>
        function toggleKeyboard() {
            const kb = document.getElementById('math-keyboard');
            kb.style.display = kb.style.display === 'flex' ? 'none' : 'flex';
        }

        function insertSymbol(sym) {
            const textarea = document.getElementById('question');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            textarea.value = text.slice(0, start) + sym + text.slice(end);
            textarea.selectionStart = textarea.selectionEnd = start + sym.length;
            textarea.focus();
        }

        function sendQuestion() {
            const question = document.getElementById('question').value.trim();
            const domain = document.getElementById('domain-selector').value;
            
            if (!question) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„!");
                return;
            }
            
            // Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            appendMessage(question, 'user');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            showLoading();
            
            // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø®Ø§Ø¯Ù…
            fetch('/solve', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    question: question,
                    domain: domain
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                displayResult(data, domain);
            })
            .catch(error => {
                hideLoading();
                appendMessage('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'bot');
                console.error('Error:', error);
            });
            
            document.getElementById('question').value = '';
        }

        function displayResult(data, domain) {
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ®ØµØµ
            displayDomainInfo(domain, data.confidence || 99);
            
            // Ø¹Ø±Ø¶ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„
            displaySolution(data.solution || {
                steps: ['Ù„Ù… ÙŠØªÙ… ØªÙˆÙÙŠØ± Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„'],
                answer: data.answer || 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±...'
            });
            
            // Ø¹Ø±Ø¶ Ø´Ø±Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            displayAIExplanation(data.ai_explanation || 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function displayDomainInfo(domain, confidence) {
            const domainNames = {
                'mathematics': 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
                'physics': 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡',
                'mechanical': 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©',
                'electrical': 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
                'electronics': 'Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',
                'motors': 'Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
                'plc': 'PLC ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¢Ù„ÙŠ'
            };
            
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ badge Ù‚Ø¯ÙŠÙ…
            const oldBadge = document.querySelector('.domain-badge');
            if (oldBadge) oldBadge.remove();
            
            const badge = document.createElement('div');
            badge.className = `domain-badge ${domain}`;
            badge.innerHTML = `
                <span>${domainNames[domain] || domain}</span>
                <span style="margin-right: 15px;">ğŸ” Ø¯Ù‚Ø©: ${confidence}%</span>
            `;
            
            document.getElementById('answer-section').insertBefore(
                badge, 
                document.getElementById('solution-container')
            );
            
            // ØªØ­Ø¯ÙŠØ« badge Ø§Ù„Ø«Ù‚Ø©
            document.getElementById('confidence-badge').textContent = `${confidence}% Ø¯Ù‚Ø©`;
        }

        function displaySolution(solution) {
            const steps = document.getElementById('solution-steps');
            steps.innerHTML = '';
            
            if (solution.steps && Array.isArray(solution.steps)) {
                solution.steps.forEach((step, index) => {
                    const stepDiv = document.createElement('div');
                    stepDiv.style.marginBottom = '15px';
                    stepDiv.style.padding = '8px';
                    stepDiv.style.borderRight = '4px solid #4CAF50';
                    stepDiv.style.paddingRight = '15px';
                    stepDiv.style.background = '#f9f9f9';
                    stepDiv.style.borderRadius = '0 5px 5px 0';
                    stepDiv.innerHTML = `<strong>Ø§Ù„Ø®Ø·ÙˆØ© ${index + 1}:</strong> ${step}`;
                    steps.appendChild(stepDiv);
                });
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            const answerDiv = document.createElement('div');
            answerDiv.style.marginTop = '20px';
            answerDiv.style.padding = '15px';
            answerDiv.style.background = '#e8f5e9';
            answerDiv.style.borderRadius = '8px';
            answerDiv.style.border = '1px solid #4CAF50';
            answerDiv.innerHTML = `<strong>âœ… Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${solution.answer}`;
            steps.appendChild(answerDiv);
        }

        function displayAIExplanation(explanation) {
            const aiDiv = document.getElementById('ai-explanation');
            aiDiv.innerHTML = explanation;
        }

        function showLoading() {
            document.getElementById('solution-steps').innerHTML = 
                '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©</div>';
            document.getElementById('ai-explanation').innerHTML = 
                '<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø´Ø±Ø­</div>';
        }

        function hideLoading() {
            // Ø³ØªØ³ØªØ¨Ø¯Ù„ Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ displayResult
        }

        function appendMessage(text, sender) {
            const messages = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}-message`;
            msgDiv.textContent = text;
            messages.appendChild(msgDiv);
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
</html>
